{% extends "base.html" %}
{% load i18n %}
{% load pricing_extras %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
  <h2 style="margin: 0;">{% trans "SKUs — Latest Prices" %}</h2>
  <div style="display: flex; gap: 1rem;">

    <form method="post" action="/admin/" target="_blank" style="display: inline; margin: 0;">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary btn-sm" style="min-width:160px; text-align:center;">
        <span style="margin-right: 0.5rem;">⚙️</span>
        {% trans "Configure" %}
      </button>
    </form>

    <form method="post" action="{% url 'scrape_now' %}" style="display: inline; margin: 0;">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary btn-sm" style="min-width:160px; text-align:center;">
        <span style="margin-right: 0.5rem;">🔄</span>
        {% trans "Scrape Now" %}
      </button>
    </form>
  </div>
</div>

{% if messages %}
<div style="margin-bottom:1rem;">
  {% for message in messages %}
  <div style="padding:.75rem; margin-bottom:.5rem; border-radius:.375rem;
                {% if message.tags == 'success' %}background:#d1fae5; color:#065f46; border:1px solid #a7f3d0;
                {% elif message.tags == 'error' %}background:#fee2e2; color:#dc2626; border:1px solid #fca5a5;
                {% elif message.tags == 'info' %}background:#dbeafe; color:#1d4ed8; border:1px solid #93c5fd;
                {% else %}background:#f3f4f6; color:#374151; border:1px solid #d1d5db;{% endif %}">
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

<div style="max-height:400px; overflow-y:auto; display:block; scrollbar-width:none; -ms-overflow-style:none;">
  <table style="width:100%; border-collapse:collapse;">
    <thead style="position:sticky; top:0; background:#f97316; z-index:2; color:#fff;">
      <tr>
        <th style="padding:8px 12px; border:1px solid #ddd;">{% trans "SKU" %}</th>
        <th style="padding:8px 12px; border:1px solid #ddd;">{% trans "Name" %}</th>
        <th style="padding:8px 12px; border:1px solid #ddd;">{% trans "Latest Price" %}</th>
        <th style="padding:8px 12px; border:1px solid #ddd;">{% trans "Promo" %}</th>
        <th style="padding:8px 12px; border:1px solid #ddd;">{% trans "Currency" %}</th>
        <th style="padding:8px 12px; border:1px solid #ddd;"></th>
      </tr>
    </thead>
    <tbody style="background-color:#ffffff !important;">
      {% for sku in skus %}
      <tr>
        <td
          style="padding:8px 12px; border:1px solid #ddd; background-color:#ffffff !important; color:var(--navigator-black) !important;">
          {{ sku.code }}
        </td>
        <td
          style="padding:8px 12px; border:1px solid #ddd; background-color:#ffffff !important; color:var(--navigator-black) !important;">
          {{ sku.name }}
        </td>
        <td
          style="padding:8px 12px; border:1px solid #ddd; background-color:#ffffff !important; color:var(--navigator-black) !important;">
          {% with latest_pp=latest|get_item:sku.id %}
          {% if latest_pp and latest_pp.price %}
          {{ latest_pp.price }}
          {% else %}
          <span style="color:#999;">{% trans "No data" %}</span>
          {% endif %}
          {% endwith %}
        </td>
        <td
          style="padding:8px 12px; border:1px solid #ddd; background-color:#ffffff !important; color:var(--navigator-black) !important;">
          {% with latest_pp=latest|get_item:sku.id %}
          {% if latest_pp and latest_pp.promo_price %}
          {{ latest_pp.promo_price }} ({{ latest_pp.promo_text }})
          {% else %}
          <span style="color:#999;">{% trans "No data" %}</span>
          {% endif %}
          {% endwith %}
        </td>
        <td
          style="padding:8px 12px; border:1px solid #ddd; background-color:#ffffff !important; color:var(--navigator-black) !important;">
          {% with latest_pp=latest|get_item:sku.id %}
          {% if latest_pp %}{{ latest_pp.raw_currency }}{% endif %}
          {% endwith %}
        </td>
        <td
          style="padding:8px 12px; border:1px solid #ddd; background-color:#ffffff !important; color:var(--navigator-black) !important;">
          <div class="table-actions">
            <a href="{% url 'sku_detail' sku.id %}"
              style="background-color:#999999 !important; white-space: nowrap; color:#ffffff !important; padding:4px 8px; text-decoration:none; border-radius:4px; font-size:0.875rem;">
              <span style="margin-right: 0.25rem;">📊</span>
              {% trans "View Details" %}
            </a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- esconder scrollbar no Chrome/Webkit -->
<style>
  div[style*="overflow-y:auto"]::-webkit-scrollbar {
    display: none;
  }
</style>


{% endblock %}